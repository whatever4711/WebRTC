\begin{frame}{Media Stream}\framesubtitle{aka getUserMedia}
\begin{itemize}
\item Represents synchronized streams of media
\begin{itemize}
\item taken from camera and microphone input
\item with synchronized video and audio tracks
\end{itemize}
\item Each MediaStream has an input generated by \texttt{navigator.getUserMedia()}
\item and an output, which might be passed to a video element or a RTCPeerConnection.
\end{itemize}

The \texttt{getUserMedia()} method takes three parameters:
\begin{itemize}
\item A constraints object.
\item A success callback which, if called, is passed a MediaStream.
\item A failure callback which, if called, is passed an error object.
\end{itemize}
Each MediaStream has a label. 
An array of MediaStreamTracks is returned by the \texttt{getAudioTracks()} and \texttt{getVideoTracks()} methods.
\end{frame}

\begin{frame}[containsverbatim]{Media Stream}\framesubtitle{An Audio Example}
\begin{lstlisting}
function gotStream(stream) {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioContext = new AudioContext();

    // Create an AudioNode from the stream
    var mediaStreamSource = audioContext.createMediaStreamSource(stream);

    // Connect it to destination to hear yourself
    // or any other node for processing!
    mediaStreamSource.connect(audioContext.destination);
}

navigator.getUserMedia({audio:true}, gotStream);
\end{lstlisting}
\end{frame}

\begin{frame}{RTCPeerConnection}
Signaling is used to exchange three types of information
\begin{itemize}
\item Session control messages: to initialize or close communication and report errors.
\item Network configuration: to the outside world, what's my computer's IP address and port?
\item Media capabilities: what codecs and resolutions can be handled by my browser and the browser it wants to communicate with?
\end{itemize}
The exchange of information via signaling must have completed successfully before peer-to-peer streaming can begin.
\end{frame}

\begin{frame}[allowframebreaks, containsverbatim]{RTCPeerConnection}
\begin{lstlisting}
var signalingChannel = createSignalingChannel();
var pc;
var configuration = ...; 
// run start(true) to initiate a call
function start(isCaller) {
    pc = new RTCPeerConnection(configuration);
    // send any ice candidates to the other peer
    pc.onicecandidate = function (evt) {
        signalingChannel.send(JSON.stringify({ "candidate": evt.candidate }));
    };
    // once remote stream arrives, show it in the remote video element
    pc.onaddstream = function (evt) {
        remoteView.src = URL.createObjectURL(evt.stream);
    };
    // get the local stream, show it in the local video element and send it
    navigator.getUserMedia({ "audio": true, "video": true }, function (stream) {
        selfView.src = URL.createObjectURL(stream);
        pc.addStream(stream);

        if (isCaller)
            pc.createOffer(gotDescription);
        else
            pc.createAnswer(pc.remoteDescription, gotDescription);

        function gotDescription(desc) {
            pc.setLocalDescription(desc);
            signalingChannel.send(JSON.stringify({ "sdp": desc }));
        }
    });
}

signalingChannel.onmessage = function (evt) {
    if (!pc)
        start(false);

    var signal = JSON.parse(evt.data);
    if (signal.sdp)
        pc.setRemoteDescription(new RTCSessionDescription(signal.sdp));
    else
        pc.addIceCandidate(new RTCIceCandidate(signal.candidate));
};
\end{lstlisting}
\end{frame}

\begin{frame}{RTCDataChannel}
There are many potential use cases for the API, including
\begin{itemize}
\item Gaming
\item Remote desktop applications
\item Real-time text chat
\item File transfer
\item Decentralized networks
\end{itemize}
The API has several features to make the most of RTCPeerConnection and enable powerful and flexible peer-to-peer communication:

\begin{itemize}
\item Leveraging of RTCPeerConnection session setup.
\item Multiple simultaneous channels, with prioritization.
\item Reliable and unreliable delivery semantics.
\item Built-in security (DTLS) and congestion control.
\item Ability to use with or without audio or video.
\end{itemize}
\end{frame}

\begin{frame}[containsverbatim]{RTCDataChannel}
\begin{lstlisting}
var pc = new webkitRTCPeerConnection(servers,
  {optional: [{RtpDataChannels: true}]});

pc.ondatachannel = function(event) {
  receiveChannel = event.channel;
  receiveChannel.onmessage = function(event){
    document.querySelector("div#receive").innerHTML = event.data; };};

sendChannel = pc.createDataChannel("sendDataChannel", {reliable: false});

document.querySelector("button#send").onclick = function (){
  var data = document.querySelector("textarea#send").value;
  sendChannel.send(data);};
\end{lstlisting}
\end{frame}